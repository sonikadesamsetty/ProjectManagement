<form [formGroup]="taskForm" (ngSubmit)="saveChanges()">
    <div class="modal-header">
        <h5 class="modal-title">{{taskId!=0?taskId:'Create a New Task'}}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
    </div>
    <div class="modal-body" style="overflow-y:auto;">

        <input type="text" value="{{task?.title}}" class="form-control form-control-lg mb-3" placeholder="task Title"
            aria-label="task Title" aria-describedby="basic-addon1" formControlName="title">
        <div class="d-flex flex-row w-50 ">
            <div class="me-5">
                <p>Assigned To</p>
                <select style="width: 200px; height: 30px;" formControlName="assignedTo" value="{{assignee}}">
                    @for(member of members;track member.id;let k=$index) {
                    <option [value]="member.id">{{member.name}}</option>
                    }
                </select>

                <p class="mt-2">Status</p>
                <select style="width: 200px; height: 30px;" formControlName="status" value="{{task?.status}}">
                    <option value="new">New</option>
                    <option value="inProgress">In Progress</option>
                    <option value="done">Done</option>
                </select>
            </div>
            <div>
                <p>Priority</p>
                <select style="width: 200px; height: 30px;" formControlName="priority" value="{{task?.priority}}">
                    <option value="low">Low</option>
                    <option value="high">High</option>
                    <option value="critical">Critical</option>
                </select>

               
            </div>
        </div>

        <div class="d-flex flex-row mt-3">
            <div class="w-50">
                <p>Description</p>
                <textarea class="form-control" rows="5" formControlName="description"
                    value="task?description"></textarea>
            </div>

            <div class="d-flex flex-column w-50 ms-4">
                <div>
                    <p>Total Hours</p>
                    <input type="number" class="form-control w-25" formControlName="totalHours"
                        value="task?.totalHours" />
                </div>

                <div>
                    <p>Completed Hours</p>
                    <input type="number" class="form-control w-25" formControlName="completedHours"
                        value="task?.completedHours" />
                </div>

                <div>
                    <p>Remaining Hours</p>
                    <input type="number" class="form-control w-25" formControlName="remainingHours"
                        value="task?.remainingHours" />
                </div>
            </div>

            <div class="d-flex flex-column ms-4">
                <mat-icon title="Attachments">attachment</mat-icon>
                <mat-icon title="Delete" (click)="deleteItem()">delete</mat-icon>
            </div>

        </div>
        @if(taskId>0) {
        <div class="mt-3">
            <p>Discussion</p>
            <textarea class="form-control w-50" rows="3" formControlName="discussion" #comments
                value="task?.discussion"></textarea>
            <!-- Add save and cancel buttons below the text area at right side. it should be below text area not the full right end-->
            <!-- buttons should be visible only if i type something in textarea-->
            @if(comments.value.length > 0) {
            <div class="d-flex justify-content-end mt-2 w-50">
                <button type="button" class="btn btn-secondary me-2">Clear</button>
                <button type="button" class="btn btn-primary" (click)="addComment(comments.value)">Save</button>
            </div>
            }

            @for(comment of discussionComments; track comment.id; let i=$index) {
            <div class="border rounded p-2 mt-2 w-50">
                <p><strong>{{comment.createdBy}}</strong> <span class="text-muted"> - {{comment.createdAt | date:'short'}}</span></p>
                <p>{{comment.description}}</p>
                </div>
            }
        </div>
        }

    </div>
    <!-- footer should be at fixed position -->
    <div class="modal-footer " style="position: sticky; bottom: 0; background-color: white; right: 0;width: 100%;">
        <button type="button" class="btn btn-secondary" (click)="close()">Close</button>
        <button type="submit" class="btn btn-primary">Save changes</button>
    </div>
</form>